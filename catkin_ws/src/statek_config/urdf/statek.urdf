<?xml version="1.0" ?>
<robot name="statek"
  xmlns:xacro="http://www.ros.org/wiki/xacro">
  <xacro:arg name="statek_name" default="statek"/>

  <xacro:arg name="mu1" default="0.00"/>
  <xacro:arg name="mu2" default="0.00"/>
  <xacro:arg name="kp" default="100000"/>
  <xacro:arg name="kd" default="1"/>
  <xacro:arg name="fdir1" default="0 0 1"/>

  <joint name="left_back_wheel_hinge" type="revolute">
    <parent link="$(arg statek_name)/base_link"/>
    <child link="$(arg statek_name)/left_back_wheel"/>
    <origin rpy="0      0     -1.5708" xyz="-0.252682 0.270467 -0.03126"/>
    <axis xyz="1  0  0"/>
    <limit effort="-1" lower="-1e16" upper="1e16" velocity="-1"/>
  </joint>

  <joint name="right_back_wheel_hinge" type="revolute">
    <parent link="$(arg statek_name)/base_link"/>
    <child link="$(arg statek_name)/right_back_wheel"/>
    <origin rpy="0      0      1.5708" xyz="-0.252682 -0.264541 -0.03126"/>
    <axis xyz="1  0  0"/>
    <limit effort="-1" lower="-1e16" upper="1e16" velocity="-1"/>
  </joint>

  <joint name="left_front_wheel_hinge" type="revolute">
    <parent link="$(arg statek_name)/base_link"/>
    <child link="$(arg statek_name)/left_front_wheel"/>
    <origin rpy="0      0     -1.5708" xyz="0.167807 0.270467 -0.03126"/>
    <axis xyz="1  0  0"/>
    <limit effort="-1" lower="-1e16" upper="1e16" velocity="-1"/>
  </joint>

  <joint name="right_front_wheel_hinge" type="revolute">
    <parent link="$(arg statek_name)/base_link"/>
    <child link="$(arg statek_name)/right_front_wheel"/>
    <origin rpy="0      0      1.5708" xyz="0.167807 -0.264541 -0.03126"/>
    <axis xyz="1  0  0"/>
    <limit effort="-1" lower="-1e16" upper="1e16" velocity="-1"/>
  </joint>

  <link name="$(arg statek_name)/base_link">

    <inertial>
      <mass value="9"/>
      <origin rpy="0  0  1.57" xyz="-0.04 0 0.012"/>
      <inertia ixx="0.97125" ixy="0" ixz="0" iyy="0.51916" iyz="0" izz="1.4379"/>
    </inertial>

    <collision name="collision">
      <origin rpy="0  0  1.57" xyz="-0.04  0  0.012"/>
      <geometry>
        <box size=".62 .9 .15"/>
      </geometry>
    </collision>

    <visual name="visual">
      <origin rpy="0  0  1.57" xyz="0  0  0"/>
      <geometry>
        <mesh filename="file://$(find statek_config)/urdf/chassis.dae" scale="1.0 1.0 1.0"/>
      </geometry>
    </visual>

  </link>

  <link name="$(arg statek_name)/left_back_wheel">

    <inertial>
      <mass value="1.3"/>
      <origin rpy="0  0  1.57" xyz="0.012  0  0"/>
      <inertia ixx="0.00521083333" ixy="0" ixz="0" iyy="0.00936" iyz="0" izz="0.00521083333"/>
    </inertial>

    <collision name="collision">
      <origin rpy="-1.57  0 1.57" xyz="0.012 0  0"/>
      <geometry>
        <sphere length="0.07" radius="0.12"/>
      </geometry>
    </collision>

    <visual name="visual">
      <origin rpy="0  0  1.57" xyz="0  0  0"/>
      <geometry>
        <mesh filename="file://$(find statek_config)/urdf/wheel.dae" scale="1.0 1.0 1.0"/>
      </geometry>
    </visual>

  </link>

  <link name="$(arg statek_name)/right_back_wheel">

    <inertial>
      <mass value="1.3"/>
      <origin rpy="0  0  1.57" xyz="0.012  0  0"/>
      <inertia ixx="0.00521083333" ixy="0" ixz="0" iyy="0.00936" iyz="0" izz="0.00521083333"/>
    </inertial>

    <collision name="collision">
      <origin rpy="1.57  0    1.57" xyz="0.012 0  0"/>
      <geometry>
        <sphere length="0.07" radius="0.12"/>
      </geometry>
    </collision>

    <visual name="visual">
      <origin rpy="0  0  1.57" xyz="0  0  0"/>
      <geometry>
        <mesh filename="file://$(find statek_config)/urdf/wheel.dae" scale="1.0 1.0 1.0"/>
      </geometry>
    </visual>

  </link>

  <link name="$(arg statek_name)/left_front_wheel">

    <inertial>
      <mass value="1.3"/>
      <origin rpy="0  0  1.57" xyz="0.012  0  0"/>
      <inertia ixx="0.00521083333" ixy="0" ixz="0" iyy="0.00936" iyz="0" izz="0.00521083333"/>
    </inertial>

    <collision name="collision">
      <origin rpy="-1.57  0    1.57" xyz="0.012 0  0"/>
      <geometry>
        <sphere length="0.07" radius="0.12"/>
      </geometry>
    </collision>

    <visual name="visual">
      <origin rpy="0  0  1.57" xyz="0  0  0"/>
      <geometry>
        <mesh filename="file://$(find statek_config)/urdf/wheel.dae" scale="1.0 1.0 1.0"/>
      </geometry>
    </visual>

  </link>

  <link name="$(arg statek_name)/right_front_wheel">

    <inertial>
      <mass value="1.3"/>
      <origin rpy="0  0  1.57" xyz="0.012  0  0"/>
      <inertia ixx="0.00521083333" ixy="0" ixz="0" iyy="0.00936" iyz="0" izz="0.00521083333"/>
    </inertial>

    <collision name="collision">
      <origin rpy="1.57  0    1.57" xyz="0.012 0 0"/>
      <geometry>
        <sphere length="0.07" radius="0.12"/>
      </geometry>
    </collision>

    <visual name="visual">
      <origin rpy="0  0  1.57" xyz="0  0  0"/>
      <geometry>
        <mesh filename="file://$(find statek_config)/urdf/wheel.dae" scale="1.0 1.0 1.0"/>
      </geometry>
    </visual>

  </link>

  <gazebo reference="$(arg statek_name)/base_link">
    <sensor type="ray" name="lidar">
      <always_on>true</always_on>
      <pose>-.025 0 .15 0 0 3.08159265359</pose>
      <visualize>false</visualize>
      <update_rate>5</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>719</samples>
            <resolution>1</resolution>
            <min_angle>-3.1415</min_angle>
            <max_angle>3.1415</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>.1</min>
          <max>12</max>
          <resolution>0.05</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.01</stddev>
        </noise>
      </ray>
      <plugin name="sensor_plugin" filename="libgazebo_ros_laser.so">
        <topicName>$(arg statek_name)/scan</topicName>
        <frameName>$(arg statek_name)/laser_link</frameName>
      </plugin>
    </sensor>
  </gazebo>

  <gazebo reference="$(arg statek_name)/left_front_wheel">
    <kp value="$(arg kp)"/>
    <kd value="$(arg kd)"/>
    <mu1 value="$(arg mu1)"/>
    <mu2 value="$(arg mu2)"/>
    <fdir1 value="$(arg fdir1)"/>
  </gazebo>

  <gazebo reference="$(arg statek_name)/right_front_wheel">
    <kp>$(arg kp)</kp>
    <kd>$(arg kd)</kd>
    <mu1>$(arg mu1)</mu1>
    <mu2>$(arg mu2)</mu2>
    <fdir1>$(arg fdir1)</fdir1>
  </gazebo>

  <gazebo reference="$(arg statek_name)/left_back_wheel">
    <kp>$(arg kp)</kp>
    <kd>$(arg kd)</kd>
    <mu1>$(arg mu1)</mu1>
    <mu2>$(arg mu2)</mu2>
    <fdir1>$(arg fdir1)</fdir1>
  </gazebo>

  <gazebo reference="$(arg statek_name)/right_back_wheel">
    <kp>$(arg kp)</kp>
    <kd>$(arg kd)</kd>
    <mu1>$(arg mu1)</mu1>
    <mu2>$(arg mu2)</mu2>
    <fdir1>$(arg fdir1)</fdir1>
  </gazebo>

  <gazebo>
    <plugin name="statek_motor_control" filename="libstatek_motor_control.so">
      <left_back_joint>left_back_wheel_hinge</left_back_joint>
      <right_back_joint>right_back_wheel_hinge</right_back_joint>
      <left_front_joint>left_front_wheel_hinge</left_front_joint>
      <right_front_joint>right_front_wheel_hinge</right_front_joint>
      <kp>5</kp>
      <ki>2.5</ki>
      <kd>0</kd>
    </plugin>
  </gazebo>

</robot>
